<!DOCTYPE html>
<html>
<head>

	<script>
            function stringToHash(string) { 
                  
                  var hash = 0; 
                    
                  if (string.length == 0) return hash; 
                    
                  for (i = 0; i < string.length; i++) { 
                      char = string.charCodeAt(i); 
                      hash = ((hash << 5) - hash) + char; 
                      hash = hash & hash; 
                  } 
                    
                  return hash; 
              } 
let hpass=null;
let thePassword=null;
	String.prototype.plural = function(revert) {
		var plural = {
			'(quiz)$': "$1zes",
			'^(ox)$': "$1en",
			'([m|l])ouse$': "$1ice",
			'(matr|vert|ind)ix|ex$': "$1ices",
			'(x|ch|ss|sh)$': "$1es",
			'([^aeiouy]|qu)y$': "$1ies",
			'(hive)$': "$1s",
			'(?:([^f])fe|([lr])f)$': "$1$2ves",
			'(shea|lea|loa|thie)f$': "$1ves",
			'sis$': "ses",
			'([ti])um$': "$1a",
			'(tomat|potat|ech|her|vet)o$': "$1oes",
			'(bu)s$': "$1ses",
			'(alias)$': "$1es",
			'(octop)us$': "$1i",
			'(ax|test)is$': "$1es",
			'(us)$': "$1es",
			'([^s]+)$': "$1s"
		};
		var singular = {
			'(quiz)zes$': "$1",
			'(matr)ices$': "$1ix",
			'(vert|ind)ices$': "$1ex",
			'^(ox)en$': "$1",
			'(alias)es$': "$1",
			'(octop|vir)i$': "$1us",
			'(cris|ax|test)es$': "$1is",
			'(shoe)s$': "$1",
			'(o)es$': "$1",
			'(bus)es$': "$1",
			'([m|l])ice$': "$1ouse",
			'(x|ch|ss|sh)es$': "$1",
			'(m)ovies$': "$1ovie",
			'(s)eries$': "$1eries",
			'([^aeiouy]|qu)ies$': "$1y",
			'([lr])ves$': "$1f",
			'(tive)s$': "$1",
			'(hive)s$': "$1",
			'(li|wi|kni)ves$': "$1fe",
			'(shea|loa|lea|thie)ves$': "$1f",
			'(^analy)ses$': "$1sis",
			'((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$': "$1$2sis",
			'([ti])a$': "$1um",
			'(n)ews$': "$1ews",
			'(h|bl)ouses$': "$1ouse",
			'(corpse)s$': "$1",
			'(us)es$': "$1",
			's$': ""
		};
		var irregular = {
			'move': 'moves',
			'foot': 'feet',
			'goose': 'geese',
			'sex': 'sexes',
			'child': 'children',
			'man': 'men',
			'tooth': 'teeth',
			'person': 'people'
		};
		var uncountable = ['sheep', 'fish', 'deer', 'series', 'species', 'money', 'rice', 'information', 'equipment'];
		if (uncountable.indexOf(this.toLowerCase()) >= 0) {
			return this
		}
		for (word in irregular) {
			if (revert) {
				var pattern = new RegExp(irregular[word] + '$', 'i');
				var replace = word
			} else {
				var pattern = new RegExp(word + '$', 'i');
				var replace = irregular[word]
			}
			if (pattern.test(this)) {
				return this.replace(pattern, replace)
			}
		}
		if (revert) {
			var array = singular
		} else {
			var array = plural
		}
		for (reg in array) {
			var pattern = new RegExp(reg, 'i');
			if (pattern.test(this)) {
				return this.replace(pattern, array[reg])
			}
		}
		return this
	};
	const punctuation = ['!', '.', '?'];

	function randomItem(array) {
		const {
			length
		} = array;
		if (length === 0) {
			return
		}
		return array[Math.random() * length | 0]
	}
	async function fetchLines(url) {
		const response = await fetch(url);
		const text = await response.text();
		return text.split("\n")
	}
	async function generate() {
		const [adjectives, nouns] = await Promise.all([fetchLines("./a.txt"), fetchLines("./n.txt")]);
		return [randomItem(adjectives), randomItem(adjectives), randomItem(nouns).plural()]
	}
	async function button() {
		const phrases = await generate();
        const thePassword = (Math.floor(Math.random() * 9) + 2) + " " + phrases.join(" ") + punctuation[Math.floor(Math.random() * punctuation.length)];
		document.getElementById("password").textContent = thePassword;
        hpass=stringToHash(thePassword);
            }	
    function comingSoon() {
        alert("Coming soon.");
    }
    function checkPass() {
        let userAttempt=stringToHash(prompt("Enter the password"))
        if(userAttempt===hpass){
            alert("You've entered the password correctly");
        } else {
            alert("Sorry, that\'s not the password.");
        }
        let retry = confirm("Want to try again?")
        if (retry===true){
            checkPass()
        }
    }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

	<style>
	body {
		text-align: center;
		background-color: #202020;
		color: #f0f0f0;
        font-family: 'Roboto', sans-serif;
    	}
	a {
		color: #f0f0f0;
	}
	.button1 {
		border-radius: 4px;
		width: 90%;
		height: 5%;
		background-color: #f0f0f0;
		color: #202020
	}
    .button2 {
        background-color: #E0E0E0;
        color: #202020;
        border-radius: 4px;
		width: 90%;
		height: 5%;
    }
    #password {
        font-family: monospace;
    }
    	</style>
	<meta content="width=device-width, initial-scale=1" name="viewport">
	<title></title>
</head>
<body onload="button()">
	<h1>Your password is...</h1>
    <h2 id='password'>Still generating.</h2><button onclick='button()' class="button2">Generate Again</button><br>
    <button onclick="checkPass();" class="button2">See if you've memorised the password</button>
    <p>By using this service you agree to it's <a href="./disclaimer.txt">terms</a>.</p>
    <a href="https://github.com/fishofivory/PassPhrase" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
</body>
</html>